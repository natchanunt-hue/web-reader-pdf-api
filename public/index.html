<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Generator (API Test - Full Option)</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 450px; }
        h2 { margin-top: 0; color: #333; text-align: center; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; color: #555; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 14px; }
        button { background: #2563eb; color: white; border: none; padding: 12px; border-radius: 6px; font-size: 16px; cursor: pointer; width: 100%; margin-top: 10px; transition: 0.2s; }
        button:hover { background: #1d4ed8; }
        button:disabled { background: #ccc; }
        #status { margin-top: 15px; font-size: 13px; text-align: center; white-space: pre-wrap; color: #666; }
        .note { font-size: 12px; color: #888; margin-top: 4px; }
    </style>
</head>
<body>

<div class="card">
    <h2>üìÑ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á PDF (‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏õ‡∏Å)</h2>
    
    <div class="form-group">
        <label>1. ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Ç‡πà‡∏≤‡∏ß (URL ‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö)</label>
        <input type="text" id="urlInput" placeholder="https://..." value="https://siamrath.co.th/politics/national-politics/117111">
        <div class="note">*‡πÉ‡∏ä‡πâ‡∏î‡∏π‡∏î‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ Text ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</div>
    </div>

    <div class="form-group">
        <label>2. ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß (Title)</label>
        <input type="text" id="titleInput" placeholder="‡πÉ‡∏™‡πà‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠..." value="‡∏û.‡∏ï.‡∏≠.‡∏ó‡∏ß‡∏µ ‡∏•‡∏±‡πà‡∏ô‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏û‡∏£‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏≤‡∏ï‡∏¥ ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡∏™.‡∏™.‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ">
    </div>

    <div class="form-group">
        <label>3. ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (Date)</label>
        <input type="text" id="dateInput" placeholder="‡πÄ‡∏ä‡πà‡∏ô 14 ‡∏ò.‡∏Ñ. 68" value="15 ‡∏ò.‡∏Ñ. 68 15:12 ‡∏ô.">
    </div>

    <div class="form-group">
        <label>4. ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏õ‡∏Å (Cover Image URL)</label>
        <input type="text" id="imageInput" placeholder="https://..." value="https://siamrath.co.th/media/KVunBvWg8dY57O2MI0lSDpx4QbF">
        <div class="note">*‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ù‡∏±‡∏á‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô PDF ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á</div>
    </div>

    <button id="btnDownload" onclick="downloadPdf()">üöÄ ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF</button>
    <div id="status"></div>
</div>

<script>
    async function downloadPdf() {
        const url = document.getElementById('urlInput').value;
        const title = document.getElementById('titleInput').value;
        const dateText = document.getElementById('dateInput').value;
        const imageUrl = document.getElementById('imageInput').value; // ‚úÖ ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏£‡∏π‡∏õ‡∏õ‡∏Å
        
        const btn = document.getElementById('btnDownload');
        const status = document.getElementById('status');

        if (!url) return alert('‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Ç‡πà‡∏≤‡∏ß‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö');

        btn.disabled = true;
        btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...";
        status.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏ù‡∏±‡∏á‡∏£‡∏π‡∏õ‡∏õ‡∏Å...";
        status.style.color = "#666";

        try {
            // ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á Query String (‡∏£‡∏ß‡∏° image_url ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢)
            const params = new URLSearchParams({
                url: url,
                title: title,
                date_text: dateText,
                image_url: imageUrl // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÉ‡∏´‡πâ Backend
            });

            const apiUrl = `/api/scrape?${params.toString()}`;
            
            const response = await fetch(apiUrl);

            if (!response.ok) {
                const text = await response.text();
                throw new Error(text || `Server Error: ${response.status}`);
            }

            // ‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å Header
            let filename = "document.pdf";
            const disposition = response.headers.get('Content-Disposition');
            if (disposition) {
                const match = disposition.match(/filename\*=UTF-8''(.+)/);
                if (match && match[1]) filename = decodeURIComponent(match[1]);
            }

            const blob = await response.blob();
            const downloadUrl = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = downloadUrl;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            a.remove();
            
            status.innerText = "‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!";
            status.style.color = "green";

        } catch (error) {
            console.error(error);
            status.innerText = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message;
            status.style.color = "red";
        } finally {
            btn.disabled = false;
            btn.innerText = "üöÄ ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF";
        }
    }
</script>

</body>
</html>